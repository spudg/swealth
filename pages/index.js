import Head from "next/head";
import Header from "../components/Header";
import AssetGrid from "../components/AssetGrid";
import LiabilityGrid from "../components/LiabilityGrid";
import AddAssetForm from "../components/AddAssetForm";

import { initializeApp } from "firebase/app";
import { getFirestore } from "firebase/firestore";
import { collection, addDoc } from "firebase/firestore";
import { getDocs } from "firebase/firestore";
import {
  AppBar,
  Button,
  Dialog,
  Slide,
  Toolbar,
  Typography,
} from "@mui/material";
import { ThemeProvider } from "@mui/styles";
import React, { useEffect } from "react";

const firebaseConfig = {
  //Shhh
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

// Initialize Cloud Firestore and get a reference to the service
const db = getFirestore(app);

const Transition = React.forwardRef(function Transition(props, ref) {
  return <Slide direction="up" ref={ref} {...props} />;
});

async function testL() {
  try {
    const docRef = await addDoc(collection(db, "liabilities"), {
      date_added: "1672581257797",
      name: "testLiability",
      owner_id: "C8rZzRZsNIAhneQAY9jI",
      value: "67928.33",
    });
    console.log("Document written with ID: ", docRef.id);
  } catch (e) {
    console.error("Error adding document: ", e);
  }
}

export default function Home() {
  const [assets, setAssets] = React.useState(false);
  const [liabilities, setLiabilities] = React.useState(false);

  const handleAddAssetOpen = () => setOpenAddAsset(true);
  const handleAddAssetClose = () => setOpenAddAsset(false);
  const [openAddAsset, setOpenAddAsset] = React.useState(false);

  const getAssets = async () => {
    console.log("run");
    let assets = Array();
    const querySnapshot = await getDocs(collection(db, "assets"));
    querySnapshot.forEach((doc) => {
      let asset = doc.data();
      asset.id = doc.id;
      assets.push(asset);
    });
    setAssets(assets);
  };

  const getLiabilities = async () => {
    console.log("run");
    let liabilities = Array();
    const querySnapshot = await getDocs(collection(db, "liabilities"));
    querySnapshot.forEach((doc) => {
      let liability = doc.data();
      liability.id = doc.id;
      liabilities.push(liability);
    });
    setLiabilities(liabilities);
  };

  useEffect(() => {
    getAssets();
    getLiabilities();
  }, []);

  return (
    <>
      <Head>
        <title>swealth | Own your finances</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div style={{ marginTop: "20px", marginLeft: "20px" }}>
        <Header />
      </div>
      <div>
        <div
          style={{
            textAlign: "center",
            fontSize: "6em",
            marginTop: "100px",
          }}
        >
          £1,298,333
        </div>
        <div
          style={{
            textAlign: "center",
            color: "#84928b",
            fontSize: "1em",
            fontStyle: "italic",
          }}
        >
          NET WORTH
        </div>
        <hr
          color="#3e3e3e"
          style={{
            marginLeft: "10%",
            marginRight: "10%",
            marginTop: "50px",
          }}
        />
        <div
          className="parent"
          style={{
            textAlign: "center",
            marginTop: "75px",
          }}
        >
          <div className="assetTitle">
            <div
              style={{
                textAlign: "center",
                fontSize: "4em",
              }}
            >
              £1,928,929
            </div>
            <div
              style={{
                textAlign: "center",
                color: "#84928b",
                fontSize: ".8em",
                fontStyle: "italic",
              }}
            >
              ASSETS
            </div>
          </div>
          <div
            className="assetGrid"
            style={{ marginLeft: "150px", marginRight: "150px" }}
          >
            <Button
              onClick={handleAddAssetOpen}
              style={{ float: "right", marginRight: 80 }}
              size="large"
            >
              Add Asset
            </Button>
            <AssetGrid assets={assets} />
          </div>
          <div className="liabilityTitle">
            <div
              style={{
                textAlign: "center",
                fontSize: "4em",
              }}
            >
              £630,596
            </div>
            <div
              style={{
                textAlign: "center",
                color: "#84928b",
                fontSize: ".8em",
                fontStyle: "italic",
              }}
            >
              LIABILITIES
            </div>
          </div>
          <div
            className="liabilityGrid"
            style={{ marginLeft: "150px", marginRight: "150px" }}
          >
            <Button onClick={testL}>Add</Button>
            <LiabilityGrid liabilities={liabilities} />
          </div>
        </div>
      </div>
      <Dialog
        open={openAddAsset}
        onClose={handleAddAssetClose}
        TransitionComponent={Transition}
        PaperProps={{
          style: { borderRadius: 15 },
        }}
      >
        <ThemeProvider>
          <AppBar
            sx={{ position: "relative" }}
            style={{ background: "#ff00ff" }}
          >
            <Toolbar variant="dense">
              <Typography sx={{ ml: 3, flex: 1 }} variant="h6" component="div">
                Add asset
              </Typography>
              <Button autoFocus color="inherit" onClick={handleAddAssetClose}>
                Close
              </Button>
            </Toolbar>
          </AppBar>
        </ThemeProvider>
        <div
          style={{
            margin: "20px",
            marginLeft: "80px",
            marginRight: "80px",
          }}
        >
          <AddAssetForm />
        </div>
      </Dialog>
      ;
    </>
  );
}
